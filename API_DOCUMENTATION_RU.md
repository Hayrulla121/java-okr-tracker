# API Документация - OKR Tracking System

## Обзор

Данный документ содержит полное описание REST API системы отслеживания OKR (Objectives and Key Results).

**Базовый URL:** `/api`
**Формат данных:** JSON
**Аутентификация:** JWT Bearer Token

---

## Содержание

1. [Аутентификация](#1-аутентификация)
2. [Управление пользователями](#2-управление-пользователями)
3. [Дивизионы](#3-дивизионы)
4. [Департаменты](#4-департаменты)
5. [Цели (Objectives)](#5-цели-objectives)
6. [Ключевые результаты (Key Results)](#6-ключевые-результаты-key-results)
7. [Оценки](#7-оценки)
8. [Уровни оценок](#8-уровни-оценок)
9. [Экспорт](#9-экспорт)
10. [DTO модели](#10-dto-модели)

---

## 1. Аутентификация

**Базовый путь:** `/api/auth`

### 1.1 Вход в систему

```
POST /api/auth/login
```

**Описание:** Аутентификация пользователя по логину и паролю.

**Доступ:** Публичный

**Тело запроса:**
```json
{
  "username": "string",
  "password": "string"
}
```

**Ответ:** `LoginResponse`
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5...",
  "type": "Bearer",
  "user": { ... }
}
```

---

### 1.2 Регистрация пользователя

```
POST /api/auth/register
```

**Описание:** Регистрация нового пользователя в системе.

**Доступ:** Только ADMIN

**Тело запроса:**
```json
{
  "username": "string",
  "email": "string",
  "password": "string",
  "fullName": "string",
  "role": "ADMIN | DIRECTOR | HR | BUSINESS_BLOCK | USER",
  "departmentId": "string (optional)"
}
```

**Ответ:** `UserDTO`

---

### 1.3 Информация о текущем пользователе

```
GET /api/auth/me
```

**Описание:** Получение информации о текущем авторизованном пользователе.

**Доступ:** Авторизованные пользователи

**Ответ:** `UserDTO`

---

## 2. Управление пользователями

**Базовый путь:** `/api/users`

### 2.1 Получить всех пользователей

```
GET /api/users
```

**Описание:** Получение списка всех пользователей системы.

**Доступ:** ADMIN, DIRECTOR

**Ответ:** `List<UserDTO>`

---

### 2.2 Получить пользователей с оценками

```
GET /api/users/with-scores
```

**Описание:** Получение списка пользователей с их общими оценками (Team Overview).

**Доступ:** ADMIN, DIRECTOR

**Ответ:** `List<UserWithScoreDTO>`

---

### 2.3 Получить пользователя по ID

```
GET /api/users/{id}
```

**Описание:** Получение информации о конкретном пользователе.

**Доступ:** ADMIN, DIRECTOR, или сам пользователь

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | UUID | Идентификатор пользователя |

**Ответ:** `UserDTO`

---

### 2.4 Создать пользователя

```
POST /api/users
```

**Описание:** Создание нового пользователя.

**Доступ:** Только ADMIN

**Тело запроса:**
```json
{
  "username": "string",
  "email": "string",
  "password": "string",
  "fullName": "string",
  "role": "ADMIN | DIRECTOR | HR | BUSINESS_BLOCK | USER",
  "assignedDepartmentIds": ["string"],
  "jobTitle": "string (optional)",
  "phoneNumber": "string (optional)",
  "bio": "string (optional)"
}
```

**Ответ:** `UserDTO`

---

### 2.5 Обновить пользователя

```
PUT /api/users/{id}
```

**Описание:** Обновление информации о пользователе.

**Доступ:** ADMIN (все поля), сам пользователь (только профильные поля)

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | UUID | Идентификатор пользователя |

**Тело запроса:**
```json
{
  "fullName": "string (optional)",
  "email": "string (optional)",
  "jobTitle": "string (optional)",
  "phoneNumber": "string (optional)",
  "bio": "string (optional)",
  "role": "string (optional, ADMIN only)",
  "assignedDepartmentIds": ["string"] (optional, ADMIN only),
  "isActive": "boolean (optional, ADMIN only)",
  "canEditAssignedDepartments": "boolean (optional, ADMIN only)",
  "password": "string (optional)"
}
```

**Ответ:** `UserDTO`

---

### 2.6 Удалить пользователя

```
DELETE /api/users/{id}
```

**Описание:** Удаление пользователя из системы.

**Доступ:** Только ADMIN (нельзя удалить себя)

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | UUID | Идентификатор пользователя |

**Ответ:** `204 No Content`

---

### 2.7 Назначить департаменты пользователю

```
POST /api/users/{id}/departments
```

**Описание:** Назначение департаментов пользователю.

**Доступ:** Только ADMIN

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | UUID | Идентификатор пользователя |

**Тело запроса:**
```json
{
  "departmentIds": ["string"]
}
```

**Ответ:** `UserDTO`

---

### 2.8 Удалить департамент у пользователя

```
DELETE /api/users/{id}/departments/{deptId}
```

**Описание:** Удаление назначенного департамента у пользователя.

**Доступ:** Только ADMIN

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | UUID | Идентификатор пользователя |
| deptId | String | Идентификатор департамента |

**Ответ:** `UserDTO`

---

### 2.9 Загрузить фото профиля

```
POST /api/users/{id}/photo
```

**Описание:** Загрузка фотографии профиля пользователя.

**Доступ:** ADMIN или сам пользователь

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | UUID | Идентификатор пользователя |

**Тело запроса:** Multipart Form Data
| Поле | Тип | Описание |
|------|-----|----------|
| photo | File | Файл изображения |

**Ответ:** `UserDTO`

---

### 2.10 Получить пользователей по департаменту

```
GET /api/users/by-department/{deptId}
```

**Описание:** Получение списка пользователей, назначенных на департамент.

**Доступ:** Авторизованные пользователи

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| deptId | String | Идентификатор департамента |

**Ответ:** `List<UserDTO>`

---

### 2.11 Получить профиль текущего пользователя

```
GET /api/users/me/profile
```

**Описание:** Получение расширенного профиля текущего пользователя.

**Доступ:** Авторизованные пользователи

**Ответ:** `UserProfileDTO`

---

## 3. Дивизионы

**Базовый путь:** `/api/divisions`

### 3.1 Получить все дивизионы

```
GET /api/divisions
```

**Описание:** Получение списка всех дивизионов.

**Доступ:** Авторизованные пользователи

**Ответ:** `List<DivisionDTO>`

---

### 3.2 Получить дивизион по ID

```
GET /api/divisions/{id}
```

**Описание:** Получение информации о конкретном дивизионе.

**Доступ:** Авторизованные пользователи

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор дивизиона |

**Ответ:** `DivisionDTO`

---

### 3.3 Создать дивизион

```
POST /api/divisions
```

**Описание:** Создание нового дивизиона.

**Доступ:** ADMIN, DIRECTOR

**Тело запроса:**
```json
{
  "name": "string",
  "leaderId": "UUID (optional)"
}
```

**Ответ:** `DivisionDTO` (201 Created)

---

### 3.4 Обновить дивизион

```
PUT /api/divisions/{id}
```

**Описание:** Обновление информации о дивизионе.

**Доступ:** Пользователи с правами редактирования

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор дивизиона |

**Тело запроса:**
```json
{
  "name": "string (optional)",
  "leaderId": "UUID (optional)"
}
```

**Ответ:** `DivisionDTO`

---

### 3.5 Удалить дивизион

```
DELETE /api/divisions/{id}
```

**Описание:** Удаление дивизиона (только если нет департаментов).

**Доступ:** Только ADMIN

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор дивизиона |

**Ответ:** `204 No Content`

---

### 3.6 Получить департаменты дивизиона

```
GET /api/divisions/{id}/departments
```

**Описание:** Получение списка всех департаментов в дивизионе.

**Доступ:** Авторизованные пользователи

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор дивизиона |

**Ответ:** `List<DepartmentSummaryDTO>`

---

## 4. Департаменты

**Базовый путь:** `/api/departments`

### 4.1 Получить все департаменты

```
GET /api/departments
```

**Описание:** Получение списка всех департаментов.

**Доступ:** Авторизованные пользователи

**Ответ:** `List<DepartmentDTO>`

---

### 4.2 Получить департамент по ID

```
GET /api/departments/{id}
```

**Описание:** Получение информации о конкретном департаменте.

**Доступ:** Авторизованные пользователи

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор департамента |

**Ответ:** `DepartmentDTO`

---

### 4.3 Создать департамент

```
POST /api/departments
```

**Описание:** Создание нового департамента.

**Доступ:** ADMIN, DIRECTOR

**Тело запроса:**
```json
{
  "name": "string",
  "divisionId": "string (optional)",
  "objectives": []
}
```

**Ответ:** `DepartmentDTO`

---

### 4.4 Обновить департамент

```
PUT /api/departments/{id}
```

**Описание:** Обновление информации о департаменте.

**Доступ:** Пользователи с правами редактирования департамента

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор департамента |

**Тело запроса:** `DepartmentDTO`

**Ответ:** `DepartmentDTO`

---

### 4.5 Удалить департамент

```
DELETE /api/departments/{id}
```

**Описание:** Удаление департамента.

**Доступ:** Только ADMIN

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор департамента |

**Ответ:** `204 No Content`

---

### 4.6 Получить оценки департамента

```
GET /api/departments/{id}/scores
```

**Описание:** Получение оценок департамента с детализацией по оценщикам.

**Доступ:** Авторизованные пользователи

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор департамента |

**Ответ:** `DepartmentScoreResult`

---

## 5. Цели (Objectives)

### 5.1 Создать цель

```
POST /api/departments/{departmentId}/objectives
```

**Описание:** Создание новой цели для департамента.

**Доступ:** Пользователи с правами редактирования департамента

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| departmentId | String | Идентификатор департамента |

**Тело запроса:**
```json
{
  "name": "string",
  "weight": "number (0-100)",
  "departmentId": "string",
  "keyResults": []
}
```

**Ответ:** `ObjectiveDTO`

---

### 5.2 Обновить цель

```
PUT /api/objectives/{id}
```

**Описание:** Обновление существующей цели.

**Доступ:** Пользователи с правами редактирования родительского департамента

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор цели |

**Тело запроса:** `ObjectiveDTO`

**Ответ:** `ObjectiveDTO`

---

### 5.3 Удалить цель

```
DELETE /api/objectives/{id}
```

**Описание:** Удаление цели.

**Доступ:** Пользователи с правами редактирования родительского департамента

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор цели |

**Ответ:** `204 No Content`

---

## 6. Ключевые результаты (Key Results)

### 6.1 Создать ключевой результат

```
POST /api/objectives/{objectiveId}/key-results
```

**Описание:** Создание нового ключевого результата для цели.

**Доступ:** Пользователи с правами редактирования родительского департамента

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| objectiveId | String | Идентификатор цели |

**Тело запроса:**
```json
{
  "name": "string",
  "description": "string (optional)",
  "metricType": "PERCENTAGE | NUMBER | CURRENCY | BOOLEAN",
  "unit": "string (optional)",
  "weight": "number (0-100)",
  "thresholds": {
    "red": "number",
    "yellow": "number",
    "green": "number"
  },
  "actualValue": "number (optional)"
}
```

**Ответ:** `KeyResultDTO`

---

### 6.2 Обновить ключевой результат

```
PUT /api/key-results/{id}
```

**Описание:** Обновление существующего ключевого результата.

**Доступ:** Пользователи с правами редактирования родительского департамента

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор ключевого результата |

**Тело запроса:** `KeyResultDTO`

**Ответ:** `KeyResultDTO`

---

### 6.3 Обновить фактическое значение

```
PUT /api/key-results/{id}/actual-value
```

**Описание:** Обновление только фактического значения ключевого результата.

**Доступ:** Пользователи с правами редактирования родительского департамента

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор ключевого результата |

**Тело запроса:**
```json
{
  "actualValue": "string"
}
```

**Ответ:** `KeyResultDTO`

---

### 6.4 Удалить ключевой результат

```
DELETE /api/key-results/{id}
```

**Описание:** Удаление ключевого результата.

**Доступ:** Пользователи с правами редактирования родительского департамента

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | String | Идентификатор ключевого результата |

**Ответ:** `204 No Content`

---

## 7. Оценки

**Базовый путь:** `/api/evaluations`

### 7.1 Создать оценку

```
POST /api/evaluations
```

**Описание:** Создание новой оценки для департамента или сотрудника.

**Доступ:** DIRECTOR, HR, BUSINESS_BLOCK, ADMIN

**Тело запроса:**
```json
{
  "targetType": "DEPARTMENT | EMPLOYEE",
  "targetId": "UUID",
  "evaluatorType": "DIRECTOR | HR | BUSINESS_BLOCK",
  "numericRating": "number (optional, 0-100)",
  "starRating": "number (optional, 1-5)",
  "letterRating": "A | B | C | D | F (optional)",
  "comment": "string (optional)"
}
```

**Ответ:** `EvaluationDTO`

---

### 7.2 Отправить оценку

```
POST /api/evaluations/{id}/submit
```

**Описание:** Отправка черновика оценки (DRAFT → SUBMITTED).

**Доступ:** DIRECTOR, HR, BUSINESS_BLOCK, ADMIN (создатель оценки)

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | UUID | Идентификатор оценки |

**Ответ:** `EvaluationDTO`

---

### 7.3 Обновить оценку

```
PUT /api/evaluations/{id}
```

**Описание:** Обновление существующей оценки.

**Доступ:** DIRECTOR, HR, BUSINESS_BLOCK, ADMIN (создатель оценки)

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | UUID | Идентификатор оценки |

**Тело запроса:** `EvaluationCreateRequest`

**Ответ:** `EvaluationDTO`

---

### 7.4 Получить оценки по объекту

```
GET /api/evaluations/target/{type}/{id}
```

**Описание:** Получение всех оценок для указанного объекта.

**Доступ:** Авторизованные пользователи

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| type | String | Тип объекта (DEPARTMENT, EMPLOYEE) |
| id | UUID | Идентификатор объекта |

**Ответ:** `List<EvaluationDTO>`

---

### 7.5 Получить мои оценки

```
GET /api/evaluations/my
```

**Описание:** Получение списка оценок, созданных текущим пользователем.

**Доступ:** Авторизованные пользователи

**Ответ:** `List<EvaluationDTO>`

---

### 7.6 Получить все оценки

```
GET /api/evaluations/all
```

**Описание:** Получение всех оценок в системе (отладочный эндпоинт).

**Доступ:** Только ADMIN

**Ответ:** `List<EvaluationDTO>`

---

### 7.7 Удалить оценку

```
DELETE /api/evaluations/{id}
```

**Описание:** Удаление черновика оценки.

**Доступ:** DIRECTOR, HR, BUSINESS_BLOCK, ADMIN (создатель оценки)

**Параметры пути:**
| Параметр | Тип | Описание |
|----------|-----|----------|
| id | UUID | Идентификатор оценки |

**Ответ:** `204 No Content`

---

## 8. Уровни оценок

**Базовый путь:** `/api/score-levels`

### 8.1 Получить уровни оценок

```
GET /api/score-levels
```

**Описание:** Получение всех уровней оценок.

**Доступ:** Авторизованные пользователи

**Ответ:** `List<ScoreLevelDTO>`

---

### 8.2 Обновить уровни оценок

```
PUT /api/score-levels
```

**Описание:** Обновление уровней оценок.

**Доступ:** Авторизованные пользователи

**Тело запроса:**
```json
[
  {
    "id": "UUID",
    "name": "string",
    "scoreValue": "number",
    "color": "string (hex)",
    "displayOrder": "number"
  }
]
```

**Ответ:** `List<ScoreLevelDTO>`

---

### 8.3 Сбросить уровни к значениям по умолчанию

```
POST /api/score-levels/reset
```

**Описание:** Сброс уровней оценок к значениям по умолчанию.

**Доступ:** Авторизованные пользователи

**Ответ:** `200 OK`

---

## 9. Экспорт

### 9.1 Экспорт в Excel

```
GET /api/export/excel
```

**Описание:** Экспорт всех департаментов в файл Excel.

**Доступ:** Авторизованные пользователи

**Ответ:** Бинарный файл (.xlsx)

---

### 9.2 Загрузить демо-данные

```
POST /api/demo/load
```

**Описание:** Загрузка демонстрационных данных в систему.

**Доступ:** Только ADMIN

**Ответ:** `List<DepartmentDTO>`

---

## 10. DTO модели

### UserDTO
```json
{
  "id": "UUID",
  "username": "string",
  "email": "string",
  "fullName": "string",
  "role": "ADMIN | DIRECTOR | HR | BUSINESS_BLOCK | USER",
  "profilePhotoUrl": "string",
  "jobTitle": "string",
  "phoneNumber": "string",
  "bio": "string",
  "isActive": "boolean",
  "canEditAssignedDepartments": "boolean",
  "lastLogin": "datetime",
  "assignedDepartments": ["DepartmentSummaryDTO"],
  "createdAt": "datetime"
}
```

### UserWithScoreDTO
Расширяет UserDTO дополнительными полями:
```json
{
  "...UserDTO fields",
  "overallScore": "number",
  "scoreLevel": "string",
  "scoreColor": "string",
  "scorePercentage": "number"
}
```

### DivisionDTO
```json
{
  "id": "string",
  "name": "string",
  "divisionLeader": "UserDTO",
  "departments": ["DepartmentSummaryDTO"],
  "createdAt": "datetime",
  "updatedAt": "datetime"
}
```

### DepartmentDTO
```json
{
  "id": "string",
  "name": "string",
  "divisionId": "string",
  "division": "DivisionSummaryDTO",
  "objectives": ["ObjectiveDTO"],
  "score": "number",
  "finalScore": "number",
  "hasAllEvaluations": "boolean"
}
```

### ObjectiveDTO
```json
{
  "id": "string",
  "name": "string",
  "weight": "number",
  "departmentId": "string",
  "keyResults": ["KeyResultDTO"],
  "score": "number"
}
```

### KeyResultDTO
```json
{
  "id": "string",
  "name": "string",
  "description": "string",
  "metricType": "PERCENTAGE | NUMBER | CURRENCY | BOOLEAN",
  "unit": "string",
  "weight": "number",
  "thresholds": {
    "red": "number",
    "yellow": "number",
    "green": "number"
  },
  "actualValue": "number",
  "objectiveId": "string",
  "score": "number"
}
```

### EvaluationDTO
```json
{
  "id": "UUID",
  "evaluatorId": "UUID",
  "evaluatorName": "string",
  "evaluatorType": "DIRECTOR | HR | BUSINESS_BLOCK",
  "targetType": "DEPARTMENT | EMPLOYEE",
  "targetId": "UUID",
  "numericRating": "number",
  "letterRating": "A | B | C | D | F",
  "comment": "string",
  "status": "DRAFT | SUBMITTED",
  "createdAt": "datetime",
  "updatedAt": "datetime"
}
```

### ScoreLevelDTO
```json
{
  "id": "UUID",
  "name": "string",
  "scoreValue": "number",
  "color": "string",
  "displayOrder": "number"
}
```

### LoginResponse
```json
{
  "token": "string",
  "type": "Bearer",
  "user": "UserDTO"
}
```

---

## Роли и права доступа

| Роль | Описание |
|------|----------|
| **ADMIN** | Полный доступ ко всем операциям, включая управление пользователями |
| **DIRECTOR** | Создание дивизионов и департаментов, просмотр оценок команды |
| **HR** | Создание оценок (буквенные рейтинги) |
| **BUSINESS_BLOCK** | Создание оценок (числовые рейтинги) |
| **USER** | Базовый просмотр, ограниченные права редактирования |

---

## Коды ошибок

| Код | Описание |
|-----|----------|
| 200 | Успешный запрос |
| 201 | Ресурс создан |
| 204 | Ресурс удален (нет содержимого) |
| 400 | Неверный запрос |
| 401 | Не авторизован |
| 403 | Доступ запрещен |
| 404 | Ресурс не найден |
| 500 | Внутренняя ошибка сервера |

---

## Статистика API

- **Всего контроллеров:** 6
- **Всего эндпоинтов:** 50+
- **Используемые HTTP методы:** GET, POST, PUT, DELETE
